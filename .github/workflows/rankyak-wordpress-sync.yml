# File: .github/workflows/rankyak-wordpress-sync.yml
name: RankYak â†’ WordPress sync

on:
  workflow_dispatch:
    inputs:
      post_path:
        description: 'Path to the markdown in repo (e.g., _posts/2025-11-06-slug.md)'
        required: true
        type: string
      slug:
        description: 'Post slug'
        required: true
        type: string
      title:
        description: 'Post title'
        required: true
        type: string
      tags:
        description: 'Comma-separated tags'
        required: false
        type: string
  push:
    paths:
      - '_posts/**.md'

jobs:
  sync-to-wordpress:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Dependencies
        run: npm install @octokit/rest

      - name: Run Sync Script
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          WP_SITE_ID: ${{ secrets.WP_SITE_ID }}
          WP_USERNAME: ${{ secrets.WP_USERNAME }}
          WP_APP_PASSWORD: ${{ secrets.WP_APP_PASSWORD }}
          WP_PUBLISH_STATUS: ${{ vars.WP_PUBLISH_STATUS }}
          WP_FEATURED_IMAGE: ${{ vars.WP_FEATURED_IMAGE }}
          # Pass workflow inputs to the script via environment variables
          INPUT_POST_PATH: ${{ inputs.post_path }}
          INPUT_SLUG: ${{ inputs.slug }}
          INPUT_TITLE: ${{ inputs.title }}
          INPUT_TAGS: ${{ inputs.tags }}
        run: node .github/workflows/rankyak-sync-script.js
