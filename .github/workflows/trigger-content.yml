name: Trigger AI Content Workflow

on:
  # Manual trigger
  workflow_dispatch:
    inputs:
      title:
        description: 'Content Title'
        required: true
        default: 'New Blog Post'
      content:
        description: 'Content Description'
        required: true
        default: 'Content to be processed by AI'

  # Auto-trigger on new markdown files
  push:
    paths:
      - 'content/**/*.md'
      - 'docs/**/*.md'
      - '*.md'

  # Trigger on new issues (for content ideas)
  issues:
    types: [opened, labeled]

jobs:
  trigger-workflow:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get commit details
        id: commit-info
        run: |
          if [ "${{ github.event_name }}" = "push" ]; then
            echo "title=${{ github.event.head_commit.message }}" >> $GITHUB_OUTPUT
            echo "content=New content pushed to repository" >> $GITHUB_OUTPUT
          elif [ "${{ github.event_name }}" = "issues" ]; then
            echo "title=${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
            echo "content=${{ github.event.issue.body }}" >> $GITHUB_OUTPUT
          else
            echo "title=${{ github.event.inputs.title }}" >> $GITHUB_OUTPUT
            echo "content=${{ github.event.inputs.content }}" >> $GITHUB_OUTPUT
          fi

      - name: Trigger Zapier Workflow
        env:
          WEBHOOK_URL: "${{ secrets.ZAPIER_CATCH_HOOK_URL }}"
        run: |
          curl -X POST "$WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -H "User-Agent: GitHub-Actions" \
            -d '{
              "title": "${{ steps.commit-info.outputs.title }}",
              "content": "${{ steps.commit-info.outputs.content }}",
              "source": "GitHub Actions",
              "repository": "${{ github.repository }}",
              "commit": "${{ github.sha }}",
              "event_type": "${{ github.event_name }}",
              "branch": "${{ github.ref_name }}",
              "actor": "${{ github.actor }}",
              "timestamp": "${{ github.event.repository.updated_at }}",
              "workflow_run_id": "${{ github.run_id }}"
            }'

      - name: Workflow Success Notification
        if: success()
        run: |
          echo "âœ… AI Content workflow triggered successfully!"
          echo "ğŸ“ Title: ${{ steps.commit-info.outputs.title }}"
          echo "ğŸ”— Repository: ${{ github.repository }}"
          echo "ğŸ†” Run ID: ${{ github.run_id }}"

      - name: Workflow Failure Notification
        if: failure()
        run: |
          echo "âŒ Failed to trigger AI Content workflow"
          echo "ğŸ“ Title: ${{ steps.commit-info.outputs.title }}"
          echo "ğŸ”— Repository: ${{ github.repository }}"
          echo "ğŸ†” Run ID: ${{ github.run_id }}"
          exit 1
