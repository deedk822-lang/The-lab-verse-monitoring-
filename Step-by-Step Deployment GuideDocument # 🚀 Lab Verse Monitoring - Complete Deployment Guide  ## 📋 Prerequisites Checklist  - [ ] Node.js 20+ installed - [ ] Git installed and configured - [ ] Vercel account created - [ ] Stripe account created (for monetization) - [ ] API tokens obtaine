# ðŸš€ Lab Verse Monitoring - Complete Deployment Guide

## ðŸ“‹ Prerequisites Checklist

- [ ] Node.js 20+ installed
- [ ] Git installed and configured
- [ ] Vercel account created
- [ ] Stripe account created (for monetization)
- [ ] API tokens obtained:
  - [ ] HuggingFace API token
  - [ ] SocialPilot access token (optional)
  - [ ] Unito access token (optional)
  - [ ] WordPress.com OAuth token (optional)

---

## Phase 1: Local Setup (30 minutes)

### Step 1: Clone and Install

```bash
cd The-lab-verse-monitoring-
npm install

# Install MCP server dependencies
cd mcp-server
npm install
cd ..
```

### Step 2: Create Environment File

```bash
cp .env.example .env.local
```

Edit `.env.local` with your credentials:

```bash
# Generate secure API key
GATEWAY_API_KEY=$(openssl rand -hex 32)

# Add your tokens
HF_API_TOKEN=hf_your_token_here
SOCIALPILOT_ACCESS_TOKEN=sp_your_token_here
UNITO_ACCESS_TOKEN=unito_your_token_here
WORDPRESS_COM_OAUTH_TOKEN=wpcom_your_token_here

# Stripe (get from https://dashboard.stripe.com/apikeys)
STRIPE_SECRET_KEY=sk_test_xxxxx
STRIPE_PUBLISHABLE_KEY=pk_test_xxxxx
```

### Step 3: Create Missing API Routes

Create the directory structure:

```bash
mkdir -p pages/api/mcp/{huggingface,socialpilot,unito,wpcom}
mkdir -p pages/api/{health,checkout,webhooks}
```

Copy the HuggingFace gateway API code I provided earlier to:
`pages/api/mcp/huggingface/messages.js`

### Step 4: Test Locally

```bash
# Terminal 1: Start Next.js server
npm run dev

# Terminal 2: Start MCP gateway
npm run mcp:hf

# Terminal 3: Run tests
npm run test:hf
```

You should see:
```
âœ… HuggingFace MCP Gateway started
âœ… ALL TESTS PASSED
```

---

## Phase 2: Stripe Setup (20 minutes)

### Step 1: Create Products

1. Go to https://dashboard.stripe.com/products
2. Click "Add Product"
3. Create three products:

**Starter Plan:**
- Name: Starter
- Price: $29/month
- Recurring: Monthly
- Copy the Price ID â†’ Add to `.env.local` as `STRIPE_PRICE_STARTER`

**Professional Plan:**
- Name: Professional
- Price: $99/month
- Recurring: Monthly
- Copy the Price ID â†’ Add to `.env.local` as `STRIPE_PRICE_PRO`

**Enterprise Plan:**
- Name: Enterprise
- Price: $299/month
- Recurring: Monthly
- Copy the Price ID â†’ Add to `.env.local` as `STRIPE_PRICE_ENTERPRISE`

### Step 2: Test Mode

Make sure you're in **Test Mode** (toggle in top right of Stripe dashboard)

Use test cards:
- Success: `4242 4242 4242 4242`
- Decline: `4000 0000 0000 0002`

---

## Phase 3: Vercel Deployment (15 minutes)

### Step 1: Install Vercel CLI

```bash
npm install -g vercel
vercel login
```

### Step 2: Deploy

```bash
# First deployment (creates project)
vercel

# Follow prompts:
# Set up and deploy? Yes
# Which scope? [Your account]
# Link to existing project? No
# Project name? lab-verse-monitoring
# Directory? ./
# Override settings? No
```

### Step 3: Add Environment Variables

```bash
# Add all variables from .env.local
vercel env add GATEWAY_API_KEY
vercel env add HF_API_TOKEN
vercel env add STRIPE_SECRET_KEY
vercel env add STRIPE_PUBLISHABLE_KEY
# ... add all other variables
```

Or use the dashboard:
1. Go to https://vercel.com/dashboard
2. Select your project
3. Settings â†’ Environment Variables
4. Add all variables from `.env.local`

### Step 4: Production Deployment

```bash
vercel --prod
```

Copy your production URL (e.g., `https://lab-verse-monitoring.vercel.app`)

### Step 5: Configure Stripe Webhook

1. Go to Stripe Dashboard â†’ Developers â†’ Webhooks
2. Click "Add endpoint"
3. Endpoint URL: `https://your-domain.vercel.app/api/webhooks/stripe`
4. Select events:
   - `checkout.session.completed`
   - `customer.subscription.created`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
5. Copy webhook secret â†’ Add to Vercel env as `STRIPE_WEBHOOK_SECRET`

---

## Phase 4: MCP Gateway Deployment (10 minutes)

### Option A: Run on Same Server as Next.js

**Using PM2:**

```bash
# Install PM2
npm install -g pm2

# Start all gateways
pm2 start ecosystem.config.cjs

# Save configuration
pm2 save

# Setup auto-restart on server reboot
pm2 startup

# Monitor
pm2 monit
```

### Option B: Docker Deployment

```bash
# Build and start
docker-compose up -d

# Check logs
docker-compose logs -f mcp-gateways

# Stop
docker-compose down
```

### Option C: Separate Server

Deploy MCP gateways on a separate VPS:

1. SSH into server
2. Clone repo
3. Install dependencies
4. Set `GATEWAY_URL` to your Vercel URL
5. Run with PM2

---

## Phase 5: Testing Production (10 minutes)

### Test 1: Health Check

```bash
curl https://your-domain.vercel.app/health
```

Expected:
```json
{
  "status": "ok",
  "services": {
    "stripe": "connected",
    "mcp": "running"
  }
}
```

### Test 2: MCP Gateway

```bash
curl -X POST https://your-domain.vercel.app/api/mcp/huggingface/messages \
  -H "Authorization: Bearer YOUR_GATEWAY_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "hf-mcp",
    "messages": [{
      "role": "user",
      "content": "hf_list_models {\"search\":\"gpt2\",\"limit\":3}"
    }]
  }'
```

### Test 3: Stripe Checkout

```bash
curl -X POST https://your-domain.vercel.app/api/checkout/create \
  -H "Content-Type: application/json" \
  -d '{
    "plan": "pro",
    "email": "test@example.com"
  }'
```

Should return checkout session URL.

---

## Phase 6: Monitoring & Maintenance

### Setup Monitoring

1. **Vercel Analytics**
   - Enable in Vercel Dashboard â†’ Analytics
   - Track response times, errors

2. **PM2 Monitoring** (if using PM2)
   ```bash
   pm2 install pm2-logrotate
   pm2 set pm2-logrotate:max_size 10M
   pm2 set pm2-logrotate:retain 7
   ```

3. **Error Tracking**
   - Consider Sentry: https://sentry.io
   - Add to Next.js: `npm install @sentry/nextjs`

### Daily Operations

**Check Gateway Status:**
```bash
pm2 status
# or
docker-compose ps
```

**View Logs:**
```bash
pm2 logs
# or
docker-compose logs -f
# or
vercel logs
```

**Restart Services:**
```bash
pm2 restart all
# or
docker-compose restart
```

---

## ðŸ”§ Troubleshooting

### Problem: "401 Unauthorized" from Gateway

**Solution:**
- Verify `GATEWAY_API_KEY` matches in both Vercel and MCP server
- Check environment variables: `vercel env ls`
- Restart MCP gateways: `pm2 restart all`

### Problem: Stripe Webhook Not Working

**Solution:**
- Verify webhook URL is correct
- Check `STRIPE_WEBHOOK_SECRET` is set in Vercel
- Test webhook: Stripe Dashboard â†’ Webhooks â†’ Send test webhook
- Check logs: `vercel logs`

### Problem: MCP Gateway Timeout

**Solution:**
- Increase timeout in `vercel.json`: `"maxDuration": 60`
- Check HuggingFace API status
- Verify network connectivity
- Check rate limits

### Problem: High Memory Usage

**Solution:**
- Adjust PM2 config: `max_memory_restart: '500M'`
- Monitor: `pm2 monit`
- Consider scaling: Add more instances

---

## ðŸ“Š Success Metrics

### Week 1 Goals

- [ ] All tests passing
- [ ] Gateway responds < 500ms
- [ ] Zero critical errors
- [ ] Health check shows "ok"
- [ ] First test payment processed

### Month 1 Goals

- [ ] 10 API calls/day from MCP
- [ ] 99% uptime
- [ ] 1-3 beta users onboarded
- [ ] Documentation complete
- [ ] Landing page live

### Month 3 Goals

- [ ] 100+ API calls/day
- [ ] 10+ paying customers
- [ ] 99.9% uptime
- [ ] First white-label customer
- [ ] $1K+ MRR

---

## ðŸŽ¯ Next Steps

1. **Complete API Routes**: Implement all 4 gateway endpoints
2. **Add Authentication**: Implement user accounts and API keys
3. **Build Landing Page**: Show pricing and features
4. **Create Documentation**: API docs with examples
5. **Setup Analytics**: Track usage and revenue
6. **Add Rate Limiting**: Prevent abuse
7. **Implement Billing**: Track usage for overage charges
8. **Build Dashboard**: Customer portal

---

## ðŸ“ž Getting Help

- **GitHub Issues**: Report bugs at your repo
- **Documentation**: Check README and DEPLOYMENT_GUIDE.md
- **Community**: Discord or Slack (if available)
- **Support**: Email support@yourservice.com

---

## ðŸŽ‰ Deployment Complete!

Your Lab Verse Monitoring gateway is now live at:
- **API**: `https://your-domain.vercel.app/api/gateway/v1/chat/completions`
- **Health**: `https://your-domain.vercel.app/health`
- **Dashboard**: `https://your-domain.vercel.app` (once built)

**Congratulations! You're ready to go live! ðŸš€**
